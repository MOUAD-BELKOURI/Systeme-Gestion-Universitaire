<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{admin/layout :: head}">
    <title>Modifier étudiant</title>
</head>
<body>
<div th:replace="~{admin/layout :: sidebar}"></div>

<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 content">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1><i class="fas fa-user-edit"></i> Modifier l'étudiant</h1>
        <div>
            <a th:href="@{/admin/etudiants/{id}(id=${etudiant.id})}" class="btn btn-info me-2">
                <i class="fas fa-eye"></i> Voir
            </a>
            <a href="/admin/etudiants" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Retour
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Modifier les informations</h5>
                </div>
                <div class="card-body">
                    <form th:action="@{/admin/etudiants/{id}/edit(id=${etudiant.id})}" th:object="${etudiant}" method="post">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nom *</label>
                                <input type="text" class="form-control" th:field="*{nom}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Prénom *</label>
                                <input type="text" class="form-control" th:field="*{prenom}" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Email *</label>
                            <input type="email" class="form-control" th:field="*{email}" required>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">CNE *</label>
                                <input type="text" class="form-control" th:field="*{cne}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Date de naissance</label>
                                <input type="date" class="form-control" th:field="*{dateNaissance}">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Filière</label>
                            <select class="form-select" th:field="*{filiere.id}">
                                <option value="">Sélectionner une filière</option>
                                <option th:each="filiere : ${filieres}"
                                        th:value="${filiere.id}"
                                        th:text="${filiere.nom}"
                                        th:selected="${etudiant.filiere != null and etudiant.filiere.id == filiere.id}">
                                </option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Lieu de naissance</label>
                            <input type="text" class="form-control" th:field="*{lieuNaissance}">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Adresse</label>
                            <textarea class="form-control" th:field="*{adresse}" rows="2"></textarea>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Téléphone</label>
                            <input type="tel" class="form-control" th:field="*{telephone}">
                        </div>

                        <div class="mb-3">
                            <label class="form-label d-flex align-items-center">
                                <input type="checkbox" class="form-check-input me-2" th:field="*{active}">
                                Compte actif
                            </label>
                            <div class="form-text">
                                Désactivez cette option pour bloquer l'accès de l'étudiant au système
                            </div>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Enregistrer les modifications
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0"><i class="fas fa-user-circle"></i> Informations actuelles</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <strong>ID :</strong> <span th:text="${etudiant.id}"></span>
                    </div>
                    <div class="mb-3">
                        <strong>Date d'inscription :</strong><br>
                        <span th:text="${#temporals.format(etudiant.dateInscription, 'dd/MM/yyyy')}"></span>
                    </div>
                    <div class="mb-3">
                        <strong>Dernière connexion :</strong><br>
                        <span th:if="${etudiant.derniereConnexion}"
                              th:text="${#temporals.format(etudiant.derniereConnexion, 'dd/MM/yyyy HH:mm')}">
                        </span>
                        <span th:unless="${etudiant.derniereConnexion}" class="text-muted">
                            Jamais connecté
                        </span>
                    </div>
                    <div>
                        <strong>Statut :</strong><br>
                        <span th:if="${etudiant.active}" class="badge bg-success">Actif</span>
                        <span th:unless="${etudiant.active}" class="badge bg-danger">Inactif</span>
                    </div>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-header">
                    <h6 class="mb-0"><i class="fas fa-exclamation-triangle"></i> Précautions</h6>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning small">
                        <i class="fas fa-shield-alt"></i>
                        <strong>Sécurité :</strong>
                        <ul class="mb-0 mt-2 ps-3">
                            <li>Ne modifiez l'email que si nécessaire</li>
                            <li>Vérifiez le CNE avant modification</li>
                            <li>Le mot de passe ne peut pas être modifié ici</li>
                            <li>La désactivation bloque l'accès immédiatement</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>