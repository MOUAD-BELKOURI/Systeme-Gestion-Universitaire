<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{admin/layout :: head}">
    <title th:text="${moduleId != null} ? 'Modifier un module' : 'Créer un module'">Gestion des modules</title>
</head>
<body>
<div th:replace="~{admin/layout :: sidebar}"></div>

<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 content">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1>
            <i class="fas fa-book"></i>
            <span th:if="${moduleId != null}">Modifier le module</span>
            <span th:unless="${moduleId != null}">Créer un module</span>
        </h1>
        <div>
            <a th:href="@{/admin/modules}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Retour à la liste
            </a>
        </div>
    </div>

    <!-- Messages d'alerte -->
    <div th:if="${success}" class="alert alert-success alert-dismissible fade show">
        <span th:text="${success}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show">
        <span th:text="${error}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div class="card">
        <div class="card-body">
            <form th:action="${moduleId != null} ? @{/admin/modules/update/{id}(id=${moduleId})} : @{/admin/modules/create}"
                  method="post" th:object="${moduleDTO}">

                <div class="row">
                    <!-- Nom du module -->
                    <div class="col-md-6 mb-3">
                        <label for="nom" class="form-label">Nom du module *</label>
                        <input type="text" class="form-control" id="nom" name="nom"
                               th:field="*{nom}"
                               required>
                        <div th:if="${#fields.hasErrors('nom')}" class="text-danger">
                            <span th:errors="*{nom}"></span>
                        </div>
                    </div>

                    <!-- Filière -->
                    <div class="col-md-6 mb-3">
                        <label for="filiereId" class="form-label">Filière *</label>
                        <select class="form-select" id="filiereId" name="filiereId" th:field="*{filiereId}" required>
                            <option value="">Sélectionnez une filière</option>
                            <option th:each="filiere : ${filieres}"
                                    th:value="${filiere.id}"
                                    th:text="${filiere.nom}">
                            </option>
                        </select>
                        <div th:if="${#fields.hasErrors('filiereId')}" class="text-danger">
                            <span th:errors="*{filiereId}"></span>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- Semestre -->
                    <div class="col-md-6 mb-3">
                        <label for="semestre" class="form-label">Semestre *</label>
                        <select class="form-select" id="semestre" name="semestre" th:field="*{semestre}" required>
                            <option value="">Sélectionnez un semestre</option>
                            <option value="S1">Semestre 1</option>
                            <option value="S2">Semestre 2</option>
                            <option value="S3">Semestre 3</option>
                            <option value="S4">Semestre 4</option>
                            <option value="S5">Semestre 5</option>
                            <option value="S6">Semestre 6</option>
                        </select>
                        <div th:if="${#fields.hasErrors('semestre')}" class="text-danger">
                            <span th:errors="*{semestre}"></span>
                        </div>
                    </div>

                    <!-- Volume horaire -->
                    <div class="col-md-6 mb-3">
                        <label for="volumeHoraire" class="form-label">Volume horaire (heures) *</label>
                        <input type="number" class="form-control" id="volumeHoraire" name="volumeHoraire"
                               th:field="*{volumeHoraire}"
                               min="1" max="300" required>
                        <div th:if="${#fields.hasErrors('volumeHoraire')}" class="text-danger">
                            <span th:errors="*{volumeHoraire}"></span>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- Enseignant -->
                    <div class="col-md-6 mb-3">
                        <label for="enseignantId" class="form-label">Enseignant</label>
                        <select class="form-select" id="enseignantId" name="enseignantId" th:field="*{enseignantId}">
                            <option value="">Non affecté</option>
                            <option th:each="enseignant : ${enseignants}"
                                    th:value="${enseignant.id}"
                                    th:text="${enseignant.nom + ' ' + enseignant.prenom}">
                            </option>
                        </select>
                    </div>

                    <!-- Date de création (affichage seulement pour l'édition) -->
                    <div class="col-md-6 mb-3" th:if="${moduleCreatedAt != null}">
                        <label class="form-label">Créé le</label>
                        <div class="form-control-plaintext">
                            <span th:text="${#temporals.format(moduleCreatedAt, 'dd/MM/yyyy HH:mm')}"></span>
                        </div>
                    </div>
                </div>

                <!-- Compétences requises -->
                <div class="mb-3">
                    <label for="competencesRequises" class="form-label">Compétences requises</label>
                    <textarea class="form-control" id="competencesRequises" name="competencesRequises"
                              th:field="*{competencesRequises}" rows="3"
                              placeholder="Listez les compétences requises pour ce module..."></textarea>
                </div>

                <!-- Boutons -->
                <div class="d-flex justify-content-between">
                    <div>
                        <a th:href="@{/admin/modules}" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Annuler
                        </a>
                    </div>
                    <div>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i>
                            <span th:if="${moduleId != null}">Enregistrer les modifications</span>
                            <span th:unless="${moduleId != null}">Créer le module</span>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>